var $e=Object.defineProperty,he=Object.defineProperties;var ke=Object.getOwnPropertyDescriptors;var te=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var oe=(g,s,d)=>s in g?$e(g,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):g[s]=d,ne=(g,s)=>{for(var d in s||(s={}))Ve.call(s,d)&&oe(g,d,s[d]);if(te)for(var d of te(s))we.call(s,d)&&oe(g,d,s[d]);return g},se=(g,s)=>he(g,ke(s));import{_ as Ce,u as je,t as Re}from"./index.c67f8be3.js";/* empty css               *//* empty css               *//* empty css               *//* empty css              *//* empty css              *//* empty css               *//* empty css               *//* empty css                */import{q as Ue}from"./serve.7ae2c2ac.js";/* empty css                *//* empty css                *//* empty css                *//* empty css                *//* empty css                *//* empty css               */import{d as Se,e as f,r as Ie,c as Ne,aJ as $,A as R,B as Te,aG as e,aF as l,aC as T,aL as i,aM as u,aD as A,u as U,bb as Ae,aR as q,aS as qe,bc as Fe,b3 as Ke,bd as Be,be as De,bf as Le,aQ as Oe,bg as ze,bh as Je,bi as Pe,bj as Ee,bk as Ge,b5 as He,b0 as Qe,bl as Xe,bm as We,bn as Ye,aP as Ze,bo as xe,b4 as ea,aX as aa,bp as la}from"./arco.a53b75be.js";import{u as ta}from"./loading.c387c5f5.js";import{q as oa,d as na,g as sa,c as da,u as ra,a as ia}from"./authority.39e53377.js";import"./chart.da3854a0.js";import"./vue.0de19953.js";const ua={class:"container"},ma={name:"RoleManagement"},ca=Se(se(ne({},ma),{setup(g){const s=()=>({id:"",type:1,appName:"",name:"",identify:"",remark:"",status:0,sort:0,scopes:"admin",createdAt:"",isSupperRole:0,nodeIds:""}),d=f(""),{loading:L,setLoading:b}=ta(!0),{t:h}=je(),y=f("1"),F=f([]),K=f(),n=f(s()),S=f(!1),k=f(!1),C=f(!1),I=f(),_=f([]),O=Ie({type:"checkbox",showCheckedAll:!0,checkStrictly:!0}),z=f([]),de=Ne(()=>[{label:h("roleManagement.form.type.1"),value:1},{label:h("roleManagement.form.type.2"),value:2}]),V=async(a=y.value==="1"?{scopes:"admin"}:{scopes:"member"})=>{b(!0);try{const{data:o}=await oa(a),m=await Ue(a);F.value=o.roleList,z.value=Re(m.data.nodeTree)}catch{}finally{b(!1)}};V();const re=a=>{y.value=a,V()},J=()=>{var a;I.value="add",(a=K.value)==null||a.resetFields(),y.value==="1"?n.value.scopes="admin":n.value.scopes="member",k.value=!0},P=()=>{console.log(_),_.value.length?C.value=!0:q.error(h("roleManagement.button.confirmation.deleteAll"))},E=async(a={ids:_.value})=>{b(!0);try{await na(a),V()}catch(o){d.value=o.message}finally{b(!1),C.value=!1}},G=()=>{C.value=!1},H=async a=>{var o;b(!0),I.value="edit";try{const{data:m}=await sa({id:a.id}),v=Object.keys(m).reduce((c,j)=>(c[j]={value:m[j]},c),{});v.nodeIds.value=v.nodeIds.value.split(","),(o=K.value)==null||o.setFields(v),k.value=!0}catch{}finally{b(!1)}},ie=async({errors:a,values:o})=>{if(!a){b(!0);const m=JSON.parse(JSON.stringify(n.value));if(console.log(n.value),m.nodeIds=m.nodeIds.toString(),I.value==="add")try{await da(m),q.success(h("roleManagement.form.add.success")),V()}catch(v){d.value=v.message}finally{b(!1),k.value=!1}else try{await ra(m),q.success(h("roleManagement.form.edit.success")),V()}catch(v){d.value=v.message}finally{b(!1),k.value=!1}}},Q=async a=>{S.value=!0;try{const{data:o}=await ia({id:a.id});q.success(h("roleManagement.form.edit.success")),V()}catch{}finally{S.value=!1}};function ue(){console.log(n)}return(a,o)=>{const m=$("Breadcrumb"),v=$("icon-plus"),c=qe,j=$("icon-delete"),X=Fe,w=Ke,B=Be,W=De,r=Le,Y=$("icon-check"),Z=$("icon-close"),D=Oe,x=$("icon-edit"),ee=ze,ae=Je,me=$("icon-download"),ce=Pe,pe=Ee,fe=Ge,p=He,N=Qe,ge=Xe,le=We,ve=Ye,be=Ze,ye=xe,_e=ea,Me=aa;return R(),Te("div",ua,[e(m,{items:["menu.authority","menu.authority.roleManagement"]},null,8,["items"]),e(pe,{class:"general-card",title:a.$t("menu.authority.roleManagement")},{default:l(()=>[e(ce,{modelValue:y.value,"onUpdate:modelValue":o[2]||(o[2]=t=>y.value=t),"default-active-key":"1",onChange:re},{default:l(()=>[e(ae,{key:"1",title:a.$t("menu.card.tabOne")},{default:l(()=>[y.value==1?(R(),T(W,{key:0,style:{"margin-bottom":"16px"}},{default:l(()=>[e(B,{span:16},{default:l(()=>[e(w,null,{default:l(()=>[e(c,{type:"primary",onClick:J},{icon:l(()=>[e(v)]),default:l(()=>[i(" "+u(a.$t("roleManagement.operation.create")),1)]),_:1}),e(X,{"popup-visible":C.value,content:a.$t("roleManagement.button.confirmation.delete"),onOk:E,onCancel:G},{default:l(()=>[e(c,{type:"primary",onClick:P},{icon:l(()=>[e(j)]),default:l(()=>[i(" "+u(a.$t("roleManagement.operation.delete")),1)]),_:1})]),_:1},8,["popup-visible","content"])]),_:1})]),_:1})]),_:1})):A("",!0),y.value==1?(R(),T(ee,{key:1,selectedKeys:_.value,"onUpdate:selectedKeys":o[0]||(o[0]=t=>_.value=t),"row-key":"id",loading:U(L),data:F.value,bordered:!1,"row-selection":U(O),pagination:!1},{columns:l(()=>[e(r,{title:a.$t("roleManagement.columns.type"),"data-index":"type"},{cell:l(({record:t})=>[i(u(a.$t(`roleManagement.form.type.${t.type}`)),1)]),_:1},8,["title"]),e(r,{title:a.$t("roleManagement.columns.id"),"data-index":"id"},null,8,["title"]),e(r,{title:a.$t("roleManagement.columns.name"),"data-index":"name"},null,8,["title"]),e(r,{title:a.$t("roleManagement.columns.identify"),"data-index":"identify"},null,8,["title"]),e(r,{title:a.$t("roleManagement.columns.createdAt"),"data-index":"createdAt"},null,8,["title"]),e(r,{title:a.$t("roleManagement.columns.status"),"data-index":"status"},{cell:l(({record:t})=>[e(w,null,{default:l(()=>[e(D,{modelValue:t.status,"onUpdate:modelValue":M=>t.status=M,disabled:t.id==="1",loading:S.value,"checked-value":1,"unchecked-value":0,onChange:M=>Q(t)},{"checked-icon":l(()=>[e(Y)]),"unchecked-icon":l(()=>[e(Z)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","loading","onChange"])]),_:2},1024)]),_:1},8,["title"]),e(r,{title:a.$t("roleManagement.columns.operations"),"data-index":"operations"},{cell:l(({record:t})=>[e(c,{disabled:t.identify==="super_admin",status:"success",size:"small",onClick:M=>H(t)},{icon:l(()=>[e(x)]),default:l(()=>[i(" "+u(a.$t("roleManagement.columns.operations.edit")),1)]),_:2},1032,["disabled","onClick"])]),_:1},8,["title"])]),_:1},8,["selectedKeys","loading","data","row-selection"])):A("",!0)]),_:1},8,["title"]),e(ae,{key:"2",title:a.$t("menu.card.tabTwo")},{default:l(()=>[y.value==2?(R(),T(W,{key:0,style:{"margin-bottom":"16px"}},{default:l(()=>[e(B,{span:16},{default:l(()=>[e(w,null,{default:l(()=>[e(c,{type:"primary",onClick:J},{icon:l(()=>[e(v)]),default:l(()=>[i(" "+u(a.$t("roleManagement.operation.create")),1)]),_:1}),e(X,{"popup-visible":C.value,content:a.$t("roleManagement.button.confirmation.delete"),onOk:E,onCancel:G},{default:l(()=>[e(c,{type:"primary",onClick:P},{icon:l(()=>[e(j)]),default:l(()=>[i(" "+u(a.$t("roleManagement.operation.delete")),1)]),_:1})]),_:1},8,["popup-visible","content"])]),_:1})]),_:1}),e(B,{span:8,style:{"text-align":"right"}},{default:l(()=>[e(c,null,{icon:l(()=>[e(me)]),default:l(()=>[i(" "+u(a.$t("roleManagement.operation.download")),1)]),_:1})]),_:1})]),_:1})):A("",!0),y.value==2?(R(),T(ee,{key:1,selectedKeys:_.value,"onUpdate:selectedKeys":o[1]||(o[1]=t=>_.value=t),"row-key":"id",loading:U(L),data:F.value,bordered:!1,"row-selection":U(O),pagination:!1},{columns:l(()=>[e(r,{title:a.$t("roleManagement.columns.type"),"data-index":"type"},{cell:l(({record:t})=>[i(u(a.$t(`roleManagement.form.type.${t.type}`)),1)]),_:1},8,["title"]),e(r,{title:a.$t("roleManagement.columns.id"),"data-index":"id"},null,8,["title"]),e(r,{title:a.$t("roleManagement.columns.name"),"data-index":"name"},null,8,["title"]),e(r,{title:a.$t("roleManagement.columns.identify"),"data-index":"identify"},null,8,["title"]),e(r,{title:a.$t("roleManagement.columns.createdAt"),"data-index":"createdAt"},null,8,["title"]),e(r,{title:a.$t("roleManagement.columns.status"),"data-index":"status"},{cell:l(({record:t})=>[e(w,null,{default:l(()=>[e(D,{modelValue:t.status,"onUpdate:modelValue":M=>t.status=M,disabled:t.identify==="super_admin",loading:S.value,"checked-value":1,"unchecked-value":0,onChange:M=>Q(t)},{"checked-icon":l(()=>[e(Y)]),"unchecked-icon":l(()=>[e(Z)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","loading","onChange"])]),_:2},1024)]),_:1},8,["title"]),e(r,{title:a.$t("roleManagement.columns.operations"),"data-index":"operations"},{cell:l(({record:t})=>[e(c,{disabled:t.identify==="super_admin",status:"success",size:"small",onClick:M=>H(t)},{icon:l(()=>[e(x)]),default:l(()=>[i(" "+u(a.$t("roleManagement.columns.operations.edit")),1)]),_:2},1032,["disabled","onClick"])]),_:1},8,["title"])]),_:1},8,["selectedKeys","loading","data","row-selection"])):A("",!0)]),_:1},8,["title"])]),_:1},8,["modelValue"])]),_:1},8,["title"]),e(Me,{visible:k.value,"onUpdate:visible":o[14]||(o[14]=t=>k.value=t),width:"auto",title:I.value==="add"?a.$t("roleManagement.form.title.add"):a.$t("roleManagement.form.title.edit"),footer:!1},{default:l(()=>[e(_e,{ref_key:"formRef",ref:K,model:n.value,style:{width:"600px"},onSubmit:ie},{default:l(()=>[e(p,{field:"type",label:a.$t("roleManagement.form.type"),rules:[{required:!0,message:a.$t("roleManagement.form.placeholder.select")}]},{default:l(()=>[e(fe,{modelValue:n.value.type,"onUpdate:modelValue":o[3]||(o[3]=t=>n.value.type=t),options:U(de),placeholder:a.$t("roleManagement.form.placeholder.select")},null,8,["modelValue","options","placeholder"])]),_:1},8,["label","rules"]),Ae(e(p,{field:"id"},{default:l(()=>[e(N,{modelValue:n.value.id,"onUpdate:modelValue":o[4]||(o[4]=t=>n.value.id=t)},null,8,["modelValue"])]),_:1},512),[[la,!1]]),e(p,{field:"name",label:a.$t("roleManagement.form.name"),rules:[{required:!0,message:a.$t("roleManagement.form.placeholder.input")}],"validate-trigger":["change","input"]},{default:l(()=>[e(N,{modelValue:n.value.name,"onUpdate:modelValue":o[5]||(o[5]=t=>n.value.name=t),placeholder:a.$t("roleManagement.form.placeholder.input")},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),e(p,{field:"appName",label:a.$t("roleManagement.form.appName"),rules:[{required:!0,message:a.$t("roleManagement.form.placeholder.input")}],"validate-trigger":["change","input"]},{default:l(()=>[e(N,{modelValue:n.value.appName,"onUpdate:modelValue":o[6]||(o[6]=t=>n.value.appName=t),placeholder:a.$t("roleManagement.form.placeholder.input")},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),e(p,{field:"nodeIds",label:a.$t("roleManagement.form.nodeIds"),rules:[{required:!0,message:a.$t("roleManagement.form.placeholder.select")}]},{default:l(()=>[e(ge,{modelValue:n.value.nodeIds,"onUpdate:modelValue":o[7]||(o[7]=t=>n.value.nodeIds=t),"allow-search":!0,"allow-clear":!0,"tree-checkable":!0,"tree-check-strictly":!0,"max-tag-count":4,data:z.value,placeholder:a.$t("roleManagement.form.placeholder.select"),"dropdown-style":{minHeight:"300px",overflow:"auto"},onChange:ue},null,8,["modelValue","data","placeholder"])]),_:1},8,["label","rules"]),e(p,{field:"identify",label:a.$t("roleManagement.form.identify"),rules:[{required:!0,message:a.$t("roleManagement.form.placeholder.input")}],"validate-trigger":["change","input"]},{default:l(()=>[e(N,{modelValue:n.value.identify,"onUpdate:modelValue":o[8]||(o[8]=t=>n.value.identify=t),placeholder:a.$t("roleManagement.form.placeholder.input")},null,8,["modelValue","placeholder"])]),_:1},8,["label","rules"]),e(p,{field:"scopes",label:a.$t("menuManagement.form.scopes")},{default:l(()=>[e(w,{size:"large"},{default:l(()=>[e(ve,{modelValue:n.value.scopes,"onUpdate:modelValue":o[9]||(o[9]=t=>n.value.scopes=t),disabled:!0},{default:l(()=>[e(le,{value:"admin"},{default:l(()=>[i(u(a.$t("roleManagement.form.scopes.admin")),1)]),_:1}),e(le,{value:"member"},{default:l(()=>[i(u(a.$t("roleManagement.form.scopes.member")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["label"]),e(p,{field:"sort",label:a.$t("roleManagement.form.sort")},{default:l(()=>[e(be,{modelValue:n.value.sort,"onUpdate:modelValue":o[10]||(o[10]=t=>n.value.sort=t),placeholder:a.$t("roleManagement.form.placeholder.input"),min:0,mode:"button"},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,{field:"status",label:a.$t("roleManagement.form.status")},{default:l(()=>[e(D,{modelValue:n.value.status,"onUpdate:modelValue":o[11]||(o[11]=t=>n.value.status=t),"checked-value":1,"unchecked-value":0},null,8,["modelValue"])]),_:1},8,["label"]),e(p,{field:"remark",label:a.$t("roleManagement.form.remark")},{default:l(()=>[e(ye,{modelValue:n.value.remark,"onUpdate:modelValue":o[12]||(o[12]=t=>n.value.remark=t),placeholder:a.$t("roleManagement.form.placeholder.input")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e(p,null,{default:l(()=>[e(w,null,{default:l(()=>[e(c,{type:"primary","html-type":"submit"},{default:l(()=>[i(u(a.$t("roleManagement.button.submit")),1)]),_:1}),e(c,{type:"outline",onClick:o[13]||(o[13]=t=>a.$refs.formRef.resetFields())},{default:l(()=>[i(u(a.$t("roleManagement.button.reset")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}));var qa=Ce(ca,[["__scopeId","data-v-ea69a7ae"]]);export{qa as default};
